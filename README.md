<h1 align="center">大作业：葫芦娃大战蛇蝎精</h1>

<h3 align="center">罗雯波-151220068</h3>

## 应用概述

本次实验使用JAVA实现一个GUI应用，展示**葫芦娃大战蛇蝎精**的过程。应用运行流程如下：

1. 启动应用，展示空白页面，等待用户按键
2. 用户按下**L**或**空格**：
   1. 按下L：弹出文件选择框，读取用户所选文件进行战斗记录回放
   2. 按下空格：开始新的战斗
3. 葫芦娃战队和蛇蝎精战队分别从左右两边向对方行进，接触后进行战斗
4. 战斗至某一方全灭，等待用户按键
5. GOTO 2.

需要补充的是，通过点击关闭按钮可以使应用退出。

## 概要设计

### 包结构

项目主要有3个包：cs.lwb.gui、cs.lwb.huluwa（包括cs.lwb.huluwa.creature)、cs.lwb.log。其中gui包的职责主要是应用界面交互的设置和响应，huluwa包的职责是实现葫芦娃大战蛇蝎精的战斗过程，log包的职责是对战斗记录的输出和读取。

### 类结构

在gui包中，有一个简单的接口Drawable，所有生物都需要实现这个接口；主窗口类MainFrame继承自JFrame，对界面进行了设置；战斗面板WarPanel继承自JPanel，作为展示战斗画面的画布，并管理葫芦娃世界的运行。

在log包中，Logger实现了输出到控制台的日志；InputRecord和OutputRecord则分别是处理读入和写出战斗记录流的类。

huluwa包（这里包括huluwa.creature包)是模拟整个战斗过程的核心模块。

- 抽象类God是葫芦娃世界的管控者，负责生物的初始化，检查它们的运动、攻击、死活等状态，每一个生物的所有动作都会被God知晓并进行相应处理，每个生物可以通过与God交互连接其它生物的状态。从设计模式的角度说，God是观察者。除此之外，God还负责与WarPanel的交互，实现葫芦娃世界的绘图显示。
- GodWithInputRecord和GodWithOutputRecord继承自God，分别实现了读入战斗记录并回放以及将战斗细节写出到记录文件。
- 抽象类Creature模拟一个生物的整个生命过程，包括生成、移动、攻击、死亡等等，根据要求Creature实现了Runnable接口，以更好模拟葫芦娃世界的运行。内部包含了CreatureState、Faction、Speed、Capability等Enum类型，用以描述生物的状态、阵营、速度、战斗能力等不同的属性。
- 在huluwa.creature包中是抽象类Creature的具体实现，关于生物的共性基本上都在Creature中实现了，具体实现中需要补充的主要是不同的外观（getImage方法）和不同的行为（onTick方法），以及对生物基本属性（阵营，名字，速度，战斗能力）进行设置。
- Attack类用于模拟生物之间的一次攻击过程，实现了Runnable接口，使得生物之间的一次攻击是有过程而不是瞬时的。
- Ground类用于放置生物，管理生物的位置，并负责不同阵营生物的遭遇战发生条件判断。
- Location类用于描述生物的位置。

最后补充的是，根据要求将应用入口设置在Main类里面，Main不在默认包里而在cs.lwb包里。

### 模块协作

在这里对整个应用执行时各个模块如何进行相互协作进行说明。

1. 初始时，在Main中启动了MainFrame。MainFrame监听用户按键，并根据按键传入参数启动WarPanel。
2. WarPanel根据参数选择生成GodWithInputRecord或者GodWithOutputRecord，战斗开始。
3. God初始化各个生物，放置到Ground中，并让他们开始运行（并发），如果是战斗回放则生物的线程不会启动，他们的行为由God来指挥（这部分实现由GodWithInputRecord来改写）。
   1. 如果不是战斗回放，则生物的运动是多线程的，每次运动了之后生物都要报告God其行为（观察者模式），God会检查其是否与敌对阵营的生物发生遭遇，如果是，则会通知其发起攻击，然后会启动一个Attack线程，模拟一次攻击的过程，并绘制攻击的轨迹。Attack线程结束则一次攻击结束，生物将继续运行。如果有生物死亡，同样也要通知God，God将会更新Ground的状态。在GodWithOutputRecord中，对几个关键的状态更新的方法进行了补充，将生物的行为写出到记录文件。这里还设置了定时器，每0.1秒打一个时间戳，使得回放时能够重现时间的平滑流逝。
   2. 如果是战斗回放，则生物的运动是由God统一指挥的。具体实现由GodWithInputRecord重写，在start方法中不启动各个生物的线程，而是设置定时器，每0.1秒读入一段生物行为记录（读到当前时间戳为止），然后由God指挥各个生物复现这些行为。
4. 战斗结束后（某一阵营全灭），God将running标志设置为false，然后MainFrame可以继续接收键盘消息，开始新的战斗。

## 具体实现

## 问题解决

